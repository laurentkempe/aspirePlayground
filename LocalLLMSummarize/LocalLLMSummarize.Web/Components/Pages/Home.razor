@page "/"
@rendermode InteractiveServer
@using Dapr.Client
@inject DaprClient DaprClient

<PageTitle>Home</PageTitle>

<h1>Hello, .NET Aspire & Dapr workflow!</h1>

<FluentStack Orientation="Orientation.Vertical">
    <FluentTextField @bind-value=_slug></FluentTextField>
    <FluentButton Loading="@_summarizing" OnClick="@StartWorkflowMockAsync" Appearance="Appearance.Accent">Summarize</FluentButton>
    <FluentTextArea @bind-Value=_statuses Rows="12" Cols="60" Label="Logs" />
    <FluentTextArea @bind-Value=_summary Rows="12" Cols="60" Label="Summary"/>
</FluentStack>

@code {
    bool _summarizing = false;
    private string? _instanceId;
    private string? _statuses;
    private string _slug = "an-update-on-xamarin-support-in-rider-the-net-tools-blog-18e42ea824d";
    private string _summary = "";

    async Task StartWorkflowMockAsync()
    {
        _summarizing = true;

        _instanceId = Guid.NewGuid().ToString();
        
        UpdateStatus($"Workflow created at {DateTime.Now:HH:mm:ss}");
        UpdateStatus($"Started at {DateTime.Now:HH:mm:ss}");
        
        await Task.Delay(1000);
        
        UpdateStatus($"Still running...");
        await Task.Delay(1000);
        UpdateStatus($"Still processing article...");
        await Task.Delay(1000);
        UpdateStatus($"Generating summary...");
        await Task.Delay(1000);
        
        UpdateStatus($"Completed at {DateTime.Now:HH:mm:ss}");
        _summary = "This is a mock summary of the article for build purposes.";
        StateHasChanged();

        _summarizing = false;
    }

    private void UpdateStatus(string status)
    {
        _statuses += $"{status}{Environment.NewLine}";
        StateHasChanged();
    }
    
    // Class mocks for build purposes
    private class ArticleToSummarize
    {
        public ArticleToSummarize(string slug)
        {
            Slug = slug;
        }

        public string Slug { get; }
    }
    
    private class ArticleSummarized
    {
        public string Summary { get; set; } = "";
    }
}